<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Interactive Task Manager</title>
  <style>
    :root {
      --color-primary: #38bdf8;
      --color-primary-hover: #0ea5e9;
      --color-text: #f1f5f9;
      --color-text-secondary: #cbd5e1;
      --color-bg: #0f172a;
      --color-surface: #1e293b;
      --color-success: #22c55e;
      --color-danger: #ef4444;
    }

    body.light-mode {
      --color-primary: #0ea5e9;
      --color-primary-hover: #0284c7;
      --color-text: #1e293b;
      --color-text-secondary: #64748b;
      --color-bg: #f8fafc;
      --color-surface: #e2e8f0;
    }

    .mode-toggle {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 1001;
      background-color: var(--color-surface);
      border: 2px solid var(--color-primary);
      color: var(--color-text);
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      font-size: 0.9rem;
    }

    .mode-toggle:hover {
      background-color: var(--color-primary);
      color: var(--color-bg);
    }

    .section {
      max-height: none;
      overflow: visible;
    }

    #activeTasks {
      max-height: none;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background-color: var(--color-bg);
      color: var(--color-text);
      padding: 20px;
      min-height: 100vh;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
    }

    .header h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      color: var(--color-primary);
    }

    .header p {
      color: var(--color-text-secondary);
      font-size: 1rem;
    }

    .stats {
      display: flex;
      gap: 15px;
      margin-bottom: 30px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .stat-box {
      background-color: var(--color-surface);
      padding: 15px 25px;
      border-radius: 8px;
      border-left: 4px solid var(--color-primary);
    }

    .stat-box .number {
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--color-primary);
    }

    .stat-box .label {
      font-size: 0.85rem;
      color: var(--color-text-secondary);
      margin-top: 5px;
    }

    .new-task-section {
      background-color: var(--color-surface);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 30px;
      border-left: 4px solid var(--color-primary);
    }

    .creation-wrapper {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
    }

     .new-note-section {
 background-color: var(--color-surface);
 border-radius: 12px;
 padding: 20px;
 margin-bottom: 30px;
 border-left: 4px solid var(--color-primary);
 }
 .new-note-section h3 {
 color: var(--color-primary);
 margin-bottom: 15px;
 font-size: 1.2rem;
 }
 .note-item {
 background-color: rgba(71, 85, 105, 0.3);
 padding: 15px;
 border-radius: 8px;
 margin-bottom: 12px;
 border-left: 3px solid var(--color-primary);
 }
 .note-timestamp {
 font-size: 0.8rem;
 color: var(--color-text-secondary);
 margin-top: 10px;
 font-style: italic;
 }

    .new-task-section h3 {
      color: var(--color-primary);
      margin-bottom: 15px;
      font-size: 1.2rem;
    }

    .594
    {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .form-row {
      display: flex;
      gap: 12px;
    }

    .form-input {
      flex: 1;
      padding: 10px 12px;
      background-color: rgba(71, 85, 105, 0.3);
      border: 1px solid rgba(56, 189, 248, 0.3);
      border-radius: 6px;
      color: var(--color-text);
      font-size: 0.95rem;
    }

    .form-input::placeholder {
      color: var(--color-text-secondary);
    }

    .form-input:focus {
      outline: none;
      border-color: var(--color-primary);
      box-shadow: 0 0 0 2px rgba(56, 189, 248, 0.2);
    }

    .form-select {
      padding: 10px 12px;
      background-color: rgba(71, 85, 105, 0.3);
      border: 1px solid rgba(56, 189, 248, 0.3);
      border-radius: 6px;
      color: var(--color-text);
      font-size: 0.95rem;
    }

    .form-select:focus {
      outline: none;
      border-color: var(--color-primary);
    }

    .content-wrapper {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 30px;
    }

    .section {
      background-color: var(--color-surface);
      border-radius: 12px;
      padding: 20px;
      overflow-y: auto;
      max-height: 700px;
    }

    .section h2 {
      font-size: 1.3rem;
      margin-bottom: 15px;
      color: var(--color-primary);
      border-bottom: 2px solid var(--color-primary);
      padding-bottom: 10px;
    }

    .category {
      margin-bottom: 25px;
    }

    .category-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--color-text);
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 1px solid rgba(148, 163, 184, 0.2);
    }

    .task-item {
      margin-bottom: 15px;
      background-color: rgba(71, 85, 105, 0.3);
      padding: 12px;
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    .task-item.completed {
      opacity: 0.6;
      background-color: rgba(34, 197, 94, 0.2);
    }

    .task-item.completed .task-label {
      text-decoration: line-through;
      color: var(--color-text-secondary);
    }

    .task-main {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
      cursor: pointer;
    }

    .task-checkbox {
      width: 20px;
      height: 20px;
      cursor: pointer;
      accent-color: var(--color-primary);
      flex-shrink: 0;
    }

    .task-label {
      flex: 1;
      font-weight: 500;
      color: var(--color-text);
    }

    .task-info {
      display: flex;
      gap: 10px;
      font-size: 0.85rem;
      margin-bottom: 8px;
    }

    .task-timestamp {
      color: var(--color-text-secondary);
      font-style: italic;
    }

    .task-actions {
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
    }

    .action-btn {
      padding: 4px 8px;
      font-size: 0.8rem;
      background-color: rgba(56, 189, 248, 0.2);
      border: 1px solid var(--color-primary);
      border-radius: 4px;
      color: var(--color-primary);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .action-btn:hover {
      background-color: rgba(56, 189, 248, 0.3);
    }

    .subtasks {
      margin-left: 30px;
      display: block;
    }

    .subtask-item {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 8px;
      padding: 6px 0;
      color: var(--color-text-secondary);
      font-size: 0.95rem;
    }

    .subtask-item.completed {
      color: var(--color-text-secondary);
    }

    .subtask-item.completed input {
      opacity: 0.6;
    }

    .subtask-item.completed label {
      text-decoration: line-through;
    }

    .subtask-checkbox {
      width: 16px;
      height: 16px;
      cursor: pointer;
      accent-color: var(--color-primary);
      flex-shrink: 0;
    }

    .subtask-label {
      cursor: pointer;
      flex: 1;
    }

    .editable-text {
      cursor: text;
      padding: 2px 4px;
      border-radius: 4px;
      transition: all 0.2s ease;
    }

    .editable-text:hover {
      background-color: rgba(56, 189, 248, 0.2);
    }

    .edit-input {
      background-color: rgba(56, 189, 248, 0.1);
      color: var(--color-text);
      border: 1px solid var(--color-primary);
      padding: 4px 8px;
      border-radius: 4px;
      font-size: inherit;
      font-family: inherit;
      width: 100%;
    }

    .edit-input:focus {
      outline: none;
      box-shadow: 0 0 0 2px rgba(56, 189, 248, 0.4);
    }

    .completed-section {
      background-color: rgba(34, 197, 94, 0.1);
      border-left: 4px solid var(--color-success);
    }

    #activeTasks {
    grid-column: 1;
    grid-row: 2;
}

    #notesSection {
	border-left: 4px solid var(--color-primary);
    grid-column: 2;
    grid-row: 2;
}
#completedTasks {
    grid-column: 2;
    grid-row: 3;
}

    .button-group {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    button {
      padding: 12px 24px;
      font-size: 1rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
    }

    .btn-primary {
      background-color: var(--color-primary);
      color: #0f172a;
    }

    .btn-primary:hover {
      background-color: var(--color-primary-hover);
    }

    .btn-secondary {
      background-color: var(--color-surface);
      color: var(--color-text);
      border: 1px solid var(--color-primary);
    }

    .btn-secondary:hover {
      background-color: rgba(56, 189, 248, 0.1);
    }

    .empty-message {
      text-align: center;
      color: var(--color-text-secondary);
      padding: 30px;
      font-style: italic;
    }

    .add-subtask-input {
      display: flex;
      gap: 8px;
      margin-left: 30px;
      margin-top: 8px;
      padding: 8px 0;
    }

    .add-subtask-input input {
      flex: 1;
      padding: 6px 8px;
      background-color: rgba(56, 189, 248, 0.1);
      border: 1px solid var(--color-primary);
      border-radius: 4px;
      color: var(--color-text);
      font-size: 0.9rem;
    }

    .add-subtask-input input:focus {
      outline: none;
      box-shadow: 0 0 0 2px rgba(56, 189, 248, 0.3);
    }

    .add-subtask-input button {
      padding: 6px 12px;
      font-size: 0.9rem;
      background-color: var(--color-primary);
      color: #0f172a;
    }

    .datetime-box {
      position: fixed;
      top: 20px;
      right: 20px;
      background-color: var(--color-surface);
      padding: 12px 16px;
      border-radius: 8px;
      border-left: 4px solid var(--color-primary);
      font-size: 0.9rem;
      color: var(--color-text);
      z-index: 1000;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    .datetime-display {
      font-weight: 500;
      letter-spacing: 0.5px;
    }

    @media (max-width: 900px) {
      .content-wrapper {
        grid-template-columns: 1fr;
      }
      .form-row {
        flex-direction: column;
      }
    }

    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: transparent;
    }

    ::-webkit-scrollbar-thumb {
      background: var(--color-primary);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--color-primary-hover);
    }
    
    #backToTopBtn {
      position: fixed;
      bottom: 30px;
      right: 30px;
      z-index: 999;
      background-color: var(--color-primary);
      color: #0f172a;
      border: none;
      border-radius: 12px;
      width: 50px;
      height: 50px;
      font-size: 24px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #backToTopBtn:hover {
      background-color: var(--color-primary-hover);
      transform: translateY(-5px);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
    }

#backToTopBtn { position:fixed;bottom:30px;right:30px;padding:12px 16px;background-color:var(--color-primary);color:#0f172a;border:none;border-radius:8px;cursor:pointer;font-size:1.2rem;font-weight:600;z-index:999;transition:all .3s ease;box-shadow:0 4px 12px rgba(0,0,0,.3); }
#backToTopBtn:hover { background-color: var(--color-primary-hover); transform: translateY(-2px); }
    #backToTopBtn.show {
      display: flex;
    }
  </style>
</head>
<body>
  <button class="mode-toggle" onclick="toggleMode()">üåô Dark</button>
  <div class="datetime-box">
    <div class="datetime-display"></div>
  </div>

  <div class="container">
    <div class="header">
      <h1>üìã Task Manager</h1>
      <p>Organize, track, and complete your tasks efficiently</p>
    </div>

    <div class="stats">
      <div class="stat-box">
        <div class="number" id="totalCount">0</div>
        <div class="label">Total Tasks</div>
      </div>
      <div class="stat-box">
        <div class="number" id="completedCount">0</div>
        <div class="label">Completed</div>
      </div>
      <div class="stat-box">
        <div class="number" id="remainingCount">0</div>
        <div class="label">Remaining</div>
      </div>
      <div class="stat-box">
        <div class="number" id="progressPercent">0%</div>
        <div class="label">Progress</div>
      </div>
    </div>

    
<div class="creation-wrapper">
            <div class="section new-task-section">
      <h2>‚ûï Create New Task</h2>
      <div class="new-task-form">
        <div class="form-row">
          <select id="newTaskCategory" class="form-select">
            <option value="">Select Category...</option>
            <option value="Administrative">Administrative</option>
            <option value="Errands">Errands</option>
            <option value="Garage & Vehicle">Garage & Vehicle</option>
            <option value="Home Maintenance">Home Maintenance</option>
            <option value="Listings (eBay/Sales)">Listings (eBay/Sales)</option>
            <option value="Personal Care">Personal Care</option>
          </select>
          <input type="text" id="newTaskName" class="form-input" placeholder="Task name...">
        </div>
        <input type="text" id="newTaskSubtasks" class="form-input" placeholder="Subtasks (comma-separated, optional)">
                  <button class="btn-primary" onclick="createNewTask()">Create</button>

      </div>
    </div>
 <div class="section new-note-section">
 <h2>üìú Create New Note</h2>
 <textarea id="noteInput" class="form-input" placeholder="Write your note here..." style="height: 100px; resize: vertical;"></textarea>
 <button class="btn-primary" onclick="createNewNote()" style="margin-top: 10px;">Create Note</button>
 </div>
	
<!-- Create New Category Section -->
<div class="section new-category-section" style="grid-column: 1 / 3; grid-row: 1;">
    <h2>‚úè Create New Category</h2>
    <div class="form-row" style="gap: 10px;">
        <input type="text" id="newCategoryName" class="form-input" placeholder="Category name..." style="flex: 1;">
        <button class="btn-primary" onclick="addNewCategory()" style="padding: 10px 20px;">Add Category</button>
    </div>
</div>
<div id="activeTasks" class="section new-note-section">
	 <h2>üìã Active Tasks</h2>
</div>
<div id="notesSection" class="section" >
 <h2>üìù Notes</h2>
 <div id="notesList"></div>
 </div>
        </div>
        <div id="completedTasks" class="section completed-section">        
                      <h2>‚úì Completed Tasks</h2>
      </div>
          </div>

    <div class="button-group">
      <button class="btn-secondary" onclick="resetAll()">Reset All Tasks</button>
      <button class="btn-secondary" onclick="exportData()">Export Progress</button>
    </div>
    </div>

  <script>
    const taskData = {
      "Administrative": {
        "Call Penny": ["Follow up on status", "Document conversation"],
        "Check in on bankruptcy": ["Review case status", "Gather required documents"],
        "Organize old lists": ["Sort through old items", "Digitize important lists"],
        "Taxes": ["Gather receipts", "Organize deductions", "File return"]
      },
      "Errands": {
        "Amazon UPS return": ["Package item", "Print label", "Drop off at UPS"],
        "FedEx speaker shipping claim": ["Gather documentation", "File claim", "Follow up on status"],
        "Mailbox": ["Check mail", "Sort and file"],
        "Velcro lint brush": ["Find seller", "Purchase item", "Receive and verify"]
      },
      "Garage & Vehicle": {
        "Car wash": ["Wash exterior", "Vacuum interior", "Dry and detail"],
        "Plug in car batteries": ["Locate all batteries", "Set up chargers", "Monitor charging"],
        "Tidy up garage": ["Sweep floor", "Organize tools", "Arrange items on shelves"]
      },
      "Home Maintenance": {
        "Change Google cam charger": ["Locate old charger", "Install new charger"],
        "Magic eraser doors": ["Gather supplies", "Clean each door", "Check results"],
        "Make new Gatorade": ["Mix concentrate", "Chill in refrigerator"],
        "Patio trash can": ["Select/order can", "Receive item", "Install in location"],
        "Tidy up patio roof": ["Inspect for debris", "Clean roof area", "Check gutters"]
      },
      "Listings (eBay/Sales)": {
        "List car wheels": ["Take photos", "Write description", "Set price", "Post listing"],
        "List coats": ["Take photos", "Write description", "Set price", "Post listing"],
        "List Dior jacket": ["Take photos", "Write description", "Set price", "Post listing"],
        "List kotos": ["Take photos", "Write description", "Set price", "Post listing"],
        "List Mercedes bumper": ["Take photos", "Write description", "Set price", "Post listing"],
        "List other items": ["Take photos", "Write description", "Set price", "Post listing"],
        "List persols": ["Take photos", "Write description", "Set price", "Post listing"],
        "Relist current eBay items": ["Update photos if needed", "Refresh description", "Adjust price"]
      },
      "Personal Care": {
        "Haircut": ["Schedule appointment", "Attend appointment"],
        "Kratoms": ["Order supply", "Receive order", "Organize and store"],
        "Laundry": ["Wash clothes", "Dry clothes", "Fold and put away"],
        "Shower": ["Wash up", "Get ready"]
      }
    };

    const state = {};
     let notes = [];

    function initializeTasks() {
      for (const category in taskData) {
        for (const task in taskData[category]) {
          state[task] = {
            completed: false,
            completedAt: null,
            subtasksCompleted: new Set()
          };
        }
      }
      loadFromStorage();
      renderTasks();
      updateStats();
    }

    function createNewTask() {
      const category = document.getElementById('newTaskCategory').value;
      const taskName = document.getElementById('newTaskName').value.trim();
      const subtasksInput = document.getElementById('newTaskSubtasks').value.trim();

      if (!category || !taskName) {
        alert('Please select a category and enter a task name');
        return;
      }

      const subtasks = subtasksInput ? subtasksInput.split(',').map(s => s.trim()).filter(s => s) : ['First step', 'Second step'];

      if (!taskData[category]) {
        taskData[category] = {};
      }

      taskData[category][taskName] = subtasks;
      state[taskName] = {
        completed: false,
        completedAt: null,
        subtasksCompleted: new Set()
      };

      document.getElementById('newTaskCategory').value = '';
      document.getElementById('newTaskName').value = '';
      document.getElementById('newTaskSubtasks').value = '';

      saveToStorage();
      renderTasks();
      updateStats();
    }

    function toggleMainTask(taskName) {
      state[taskName].completed = !state[taskName].completed;

      if (state[taskName].completed) {
        state[taskName].completedAt = new Date().toLocaleString();
        const category = getCategoryForTask(taskName);
        const subtasks = taskData[category][taskName];
        subtasks.forEach((_, index) => {
          state[taskName].subtasksCompleted.add(index);
        });
      } else {
        state[taskName].completedAt = null;
        state[taskName].subtasksCompleted.clear();
      }

      saveToStorage();
      renderTasks();
      updateStats();
    }

    function toggleSubtask(taskName, subtaskIndex) {
      if (state[taskName].subtasksCompleted.has(subtaskIndex)) {
        state[taskName].subtasksCompleted.delete(subtaskIndex);
      } else {
        state[taskName].subtasksCompleted.add(subtaskIndex);
      }

      const category = getCategoryForTask(taskName);
      const subtasks = taskData[category][taskName];

      if (state[taskName].subtasksCompleted.size === subtasks.length) {
        state[taskName].completed = true;
        state[taskName].completedAt = new Date().toLocaleString();
      } else if (state[taskName].completed && state[taskName].subtasksCompleted.size < subtasks.length) {
        state[taskName].completed = false;
        state[taskName].completedAt = null;
      }

      saveToStorage();
      renderTasks();
      updateStats();
    }

    function addSubtask(taskName) {
      const subtaskText = prompt('Enter new subtask:');
      if (subtaskText && subtaskText.trim()) {
        const category = getCategoryForTask(taskName);
        taskData[category][taskName].push(subtaskText.trim());
        saveToStorage();
        renderTasks();
      }
    }

    function getCategoryForTask(taskName) {
      for (const category in taskData) {
        if (taskData[category][taskName]) {
          return category;
        }
      }
      return null;
    }

    function startEditTask(taskName) {
      const span = event.target;
      const currentText = span.textContent;
      span.innerHTML = `<input type="text" class="edit-input" value="${currentText}" id="edit-input">`;
      const input = document.getElementById('edit-input');
      input.focus();
      input.select();

      function saveEdit() {
        const newText = input.value.trim();
        if (newText && newText !== currentText) {
          const category = getCategoryForTask(taskName);
          taskData[category][newText] = taskData[category][taskName];
          delete taskData[category][taskName];
          state[newText] = state[taskName];
          delete state[taskName];
          saveToStorage();
          renderTasks();
          updateStats();
        } else {
          span.textContent = currentText;
        }
      }

      input.addEventListener('blur', saveEdit);
      input.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') saveEdit();
        if (e.key === 'Escape') span.textContent = currentText;
      });
    }

    function startEditSubtask(taskName, subtaskIndex) {
      const label = event.target;
      const currentText = label.textContent;
      label.innerHTML = `<input type="text" class="edit-input" value="${currentText}" id="edit-input">`;
      const input = document.getElementById('edit-input');
      input.focus();
      input.select();

      function saveEdit() {
        const newText = input.value.trim();
        if (newText) {
          taskData[getCategoryForTask(taskName)][taskName][subtaskIndex] = newText;
          saveToStorage();
          renderTasks();
        } else {
          label.textContent = currentText;
        }
      }

      input.addEventListener('blur', saveEdit);
      input.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') saveEdit();
        if (e.key === 'Escape') label.textContent = currentText;
      });
    }

    function renderTasks() {
      const activeContainer = document.getElementById('activeTasks');
      const completedContainer = document.getElementById('completedTasks');
      activeContainer.innerHTML = '';
      completedContainer.innerHTML = '';

      let activeCount = 0;
      let completedCount = 0;

      const sortedCategories = Object.keys(taskData).sort();

      for (const category of sortedCategories) {
        const tasks = taskData[category];
        const sortedTasks = Object.keys(tasks).sort();
        let activeCategoryHtml = '';
        let completedCategoryHtml = '';

        for (const task of sortedTasks) {
          const isCompleted = state[task].completed;
          const subtasks = tasks[task];

          const subtasksHtml = subtasks.map((subtask, index) => {
            const isSubtaskCompleted = state[task].subtasksCompleted.has(index);
            return `
              <div class="subtask-item ${isSubtaskCompleted ? 'completed' : ''}">
                <input type="checkbox" class="subtask-checkbox" ${isSubtaskCompleted ? 'checked' : ''} onchange="toggleSubtask('${task}', ${index})">
                <label class="subtask-label editable-text" onclick="event.stopPropagation(); startEditSubtask('${task}', ${index})">${subtask}</label>
              </div>
            `;
          }).join('');

          const timestampHtml = state[task].completedAt ? `<span class="task-timestamp">‚úì Completed: ${state[task].completedAt}</span>` : '';
          const addSubtaskBtn = `<button class="action-btn" onclick="event.stopPropagation(); addSubtask('${task}')">+ Add Subtask</button>`;
			 const deleteBtn = isCompleted ? `<button class="action-btn" onclick="event.stopPropagation(); deleteTask('${task}')">‚úï Delete</button>` : '';

          const taskHtml = `
            <div class="task-item ${isCompleted ? 'completed' : ''}">
              <div class="task-main" onclick="toggleMainTask('${task}')">
                <input type="checkbox" class="task-checkbox" ${isCompleted ? 'checked' : ''}>
                <span class="task-label editable-text" onclick="event.stopPropagation(); startEditTask('${task}')">${task}</span>
              </div>
              ${timestampHtml ? `<div class="task-info">${timestampHtml}</div>` : ''}
 <div class="task-actions">${addSubtaskBtn}${deleteBtn}</div>              <div class="subtasks">
                ${subtasksHtml}
              </div>
            </div>
          `;

          if (isCompleted) {
            completedCategoryHtml += taskHtml;
            completedCount++;
          } else {
            activeCategoryHtml += taskHtml;
            activeCount++;
          }
        }

        if (activeCategoryHtml) {
          activeContainer.innerHTML += `
            <div class="category">
              <div class="category-title">${category}</div>
              ${activeCategoryHtml}
            </div>
          `;
        }

        if (completedCategoryHtml) {
          completedContainer.innerHTML += `
            <div class="category completed-section">
			<h2>‚úîÔ∏è Completed Tasks</h2>
            <div class="category-title">${category}</div>
              ${completedCategoryHtml}
            </div>
          `;
        }
      }

      if (!activeContainer.innerHTML) {
        activeContainer.innerHTML = '<div class="empty-message">All tasks completed! üéâ</div>';
      }
      if (!completedContainer.innerHTML) {
        completedContainer.innerHTML = '<div class="empty-message">No completed tasks yet. Get started!</div>';
      }
    }

    function updateStats() {
      let total = 0;
      let completed = 0;

      for (const task in state) {
        total++;
        if (state[task].completed) {
          completed++;
        }
      }

      const remaining = total - completed;
      const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;

      document.getElementById('totalCount').textContent = total;
      document.getElementById('completedCount').textContent = completed;
      document.getElementById('remainingCount').textContent = remaining;
      document.getElementById('progressPercent').textContent = percentage + '%';
    }

    function saveToStorage() {
      const storageData = {};
      for (const task in state) {
        storageData[task] = {
          completed: state[task].completed,
          completedAt: state[task].completedAt,
          subtasksCompleted: Array.from(state[task].subtasksCompleted)
        };
      }
      localStorage.setItem('taskManagerState', JSON.stringify(storageData));
      localStorage.setItem('taskManagerData', JSON.stringify(taskData));
    }

    function loadFromStorage() {
      try {
        const stored = localStorage.getItem('taskManagerState');
        const storedData = localStorage.getItem('taskManagerData');

        if (storedData) {
          Object.assign(taskData, JSON.parse(storedData));
          for (const category in taskData) {
            for (const task in taskData[category]) {
              if (!state[task]) {
                state[task] = {
                  completed: false,
                  completedAt: null,
                  subtasksCompleted: new Set()
                };
              }
            }
          }
        }

        if (stored) {
          const data = JSON.parse(stored);
          for (const task in data) {
            if (state[task]) {
              state[task].completed = data[task].completed;
              state[task].completedAt = data[task].completedAt;
              state[task].subtasksCompleted = new Set(data[task].subtasksCompleted);
            }
          }
        }
      } catch (e) {
        console.log('Local storage not available, starting fresh');
      }
    }

    function resetAll() {
      if (confirm('Are you sure? This will reset all tasks and subtasks.')) {
        for (const task in state) {
          state[task].completed = false;
          state[task].completedAt = null;
          state[task].subtasksCompleted.clear();
        }
        localStorage.removeItem('taskManagerState');
        renderTasks();
        updateStats();
      }
    }

    function exportData() {
      let exportText = 'TASK MANAGER EXPORT\n';
      exportText += '==================\n\n';

      for (const category in taskData) {
        exportText += `${category}\n`;
        exportText += '-'.repeat(category.length) + '\n';
        const tasks = taskData[category];
        for (const task in tasks) {
          const isCompleted = state[task].completed;
          const timestamp = state[task].completedAt ? ` (${state[task].completedAt})` : '';
          exportText += `[${isCompleted ? 'X' : ' '}] ${task}${timestamp}\n`;
          const subtasks = tasks[task];
          subtasks.forEach((subtask, index) => {
            const isSubtaskCompleted = state[task].subtasksCompleted.has(index);
            exportText += ` [${isSubtaskCompleted ? 'X' : ' '}] ${subtask}\n`;
          });
        }
        exportText += '\n';
      }

      const blob = new Blob([exportText], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `task-export-${new Date().toISOString().split('T')[0]}.txt`;
      a.click();
      URL.revokeObjectURL(url);
    }

    function updateDateTime() {
      const now = new Date();
      const options = {
        weekday: 'long',
        month: 'long',
        day: 'numeric',
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit',
        hour12: true
      };
      document.querySelector('.datetime-display').textContent = now.toLocaleDateString('en-US', options);
    }

    updateDateTime();
    setInterval(updateDateTime, 1000);

    function toggleMode() {
      document.body.classList.toggle('light-mode');
      const isLight = document.body.classList.contains('light-mode');
      localStorage.setItem('darkMode', !isLight);
      const btn = document.querySelector('.mode-toggle');
      btn.textContent = isLight ? '‚òÄÔ∏è Light' : 'üåô Dark';
    }

    function initMode() {
      const isDarkMode = localStorage.getItem('darkMode') !== 'false';
      if (!isDarkMode) {
        document.body.classList.add('light-mode');
      }
    }

     function createNewNote() {
 const noteText = document.getElementById('noteInput').value.trim();
 if (!noteText) {
 alert('Please enter a note');
 return;
 }
 const now = new Date();
 const timestamp = now.toLocaleString();
 const note = {
 text: noteText,
 timestamp: timestamp,
 id: Date.now()
 };
 notes.unshift(note);
 document.getElementById('noteInput').value = '';
 localStorage.setItem('notes', JSON.stringify(notes));
 renderNotes();
 }
 
 function renderNotes() {
 const notesList = document.getElementById('notesList');
 if (notes.length === 0) {
 notesList.innerHTML = '<div class="empty-message">No notes yet. Create one to get started!</div>';
 return;
 }
 notesList.innerHTML = notes.map(note => `
 <div class="note-item">
 <p>${note.text}</p>
 <div class="note-timestamp">üìÖ ${note.timestamp}</div>
 <button class="delete-note-btn" onclick="deleteNote(${notes.indexOf(note)})">√ó</button>\n            </div>
 `).join('');
 }
	  
function deleteNote(index) {
    notes.splice(index, 1);
    localStorage.setItem('notes', JSON.stringify(notes));
    renderNotes();
}
 
 function loadNotes() {
 const stored = localStorage.getItem('notes');
 if (stored) {
 notes = JSON.parse(stored);
 }
 renderNotes();
 }

    initializeTasks();
    initMode();
     loadNotes();
  </script>
  
  <button id="backToTopBtn" onclick="scrollToTop()">‚Üë</button>

  <script>
    // Back to top button functionality
    const backToTopBtn = document.getElementById('backToTopBtn');

    window.addEventListener('scroll', () => {
      if (window.scrollY > 0) {
        backToTopBtn.classList.add('show');
      } else {
        backToTopBtn.classList.remove('show');
      }
    });

    function scrollToTop() {
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
    }

	   function deleteTask(taskName) { const category = getCategoryForTask(taskName); if (category && taskData[category][taskName]) { delete taskData[category][taskName]; delete state[taskName]; saveToStorage(); renderTasks(); updateStats(); } }

// Add new category function
function addNewCategory() {
    const categoryName = document.getElementById('newCategoryName').value.trim();
    if (!categoryName) {
        alert('Please enter a category name');
        return;
    }
    
    const select = document.getElementById('newTaskCategory');
    const option = document.createElement('option');
    option.value = categoryName;
    option.textContent = categoryName;
    select.appendChild(option);
    
    document.getElementById('newCategoryName').value = '';
}

// Generate AI subtask ideas
function generateAISubtasks(taskName) {
    const ideas = {
        'default': ['Plan and organize', 'Execute the task', 'Review and finalize']
    };
    const subtasks = ideas[taskName] || ideas['default'];
    const category = getCategoryForTask(taskName);
    
    for (const subtask of subtasks) {
        if (!taskData[category][taskName].includes(subtask)) {
            taskData[category][taskName].push(subtask);
        }
    }
    saveToStorage();
    renderTasks();
}

// Confetti animation function
function createConfetti() {
    const colors = ['#38bdf8', '#22c55e', '#ef4444', '#f59e0b', '#8b5cf6'];
    for (let i = 0; i < 30; i++) {
        const confetti = document.createElement('div');
        confetti.style.position = 'fixed';
        confetti.style.width = '10px';
        confetti.style.height = '10px';
        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.borderRadius = '50%';
        confetti.style.left = Math.random() * window.innerWidth + 'px';
        confetti.style.top = '-10px';
        confetti.style.zIndex = '9999';
        confetti.style.pointerEvents = 'none';
        document.body.appendChild(confetti);
        
        const duration = 2000 + Math.random() * 1000;
        const xMove = (Math.random() - 0.5) * 200;
        const keyframes = `
            @keyframes fall-${i} {
                0% { transform: translateY(0) translateX(0) rotate(0deg); opacity: 1; }
                100% { transform: translateY(${window.innerHeight + 50}px) translateX(${xMove}px) rotate(360deg); opacity: 0; }
            }
        `;
        const style = document.createElement('style');
        style.innerHTML = keyframes;
        document.head.appendChild(style);
        
        confetti.style.animation = `fall-${i} ${duration}ms linear forwards`;
        
        setTimeout(() => confetti.remove(), duration);
    }
}
  </script>
</body>
</html>
